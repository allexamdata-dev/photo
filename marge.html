<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Merger & Compressor</title>

<style>
*{margin:0;padding:0}
body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:#575759;
  padding:20px;
}
.main-wrapper{
  display:flex;
  gap:20px;
  max-width:1100px;
  margin:auto;
  height:90vh;
}
.controls-container{
  flex:1;
  background:#fff;
  padding:25px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
}
.preview-container{
  flex:1.5;
  background:#2f3640;
  border-radius:12px;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
}
#preview-frame{
  width:100%;
  height:100%;
  border:none;
  display:none;
  background:#fff;
}
.no-preview{
  color:#95a5a6;
  font-size:18px;
}
h2{
  border-bottom:2px solid #eee;
  padding-bottom:10px;
}
.btn-add,.btn-merge{
  padding:15px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
.btn-add{background:#5cb85c;color:#fff;margin-bottom:20px}
.btn-merge{background:#007bff;color:#fff;margin-top:auto}
.btn-merge:disabled{background:#bdc3c7}
#file-list{flex-grow:1;overflow:auto;margin-top:10px}
.file-item{
  display:flex;
  justify-content:space-between;
  background:#fff;
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
}
.file-name{
  max-width:180px;
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}
.action-btns button{
  margin-left:5px;
  padding:6px 10px;
  border:none;
  border-radius:4px;
  color:#fff;
  cursor:pointer;
}
.btn-view{background:#5bc0de}
.btn-del{background:#d9534f}
#status-msg{
  font-size:13px;
  margin-top:10px;
  text-align:center;
  color:#7f8c8d;
}
@media(max-width:768px){
  .main-wrapper{flex-direction:column;height:auto}
}
</style>
</head>

<body>

<div class="main-wrapper">
  <div class="controls-container">
    <h2>Merge PDFs</h2>

    <input type="file" id="pdf-input" accept="application/pdf" hidden>
    <button class="btn-add" onclick="pdfInput.click()">ADD PDF FILE</button>

    <div id="file-list"></div>

    <button id="merge-btn" class="btn-merge" disabled>Merge & Download</button>
    <div id="status-msg">Add at least 2 files</div>
  </div>

  <div class="preview-container">
    <div class="no-preview" id="placeholder">Select a file to preview</div>
    <iframe id="preview-frame"></iframe>
    <label style="margin-bottom:8px;font-weight:600">Compression Level</label>
<select id="compress-level" style="padding:10px;border-radius:6px">
  <option value="screen">High (Smallest)</option>
  <option value="ebook" selected>Medium (Recommended)</option>
  <option value="printer">Low (Best Quality)</option>
</select>


  </div>
  <div style="margin-top:15px">
  <div style="background:#eee;border-radius:6px;overflow:hidden">
    <div id="progress-bar" style="height:8px;width:0%;background:#28a745"></div>
  </div>
    <label style="margin-bottom:8px;font-weight:600">Compression Level</label>
<select id="compress-level" style="padding:10px;border-radius:6px">
  <option value="screen">High (Smallest)</option>
  <option value="ebook" selected>Medium (Recommended)</option>
  <option value="printer">Low (Best Quality)</option>
</select>
</div>
</div>

<script>
const pdfInput = document.getElementById("pdf-input");
const fileList = document.getElementById("file-list");
const mergeBtn = document.getElementById("merge-btn");
const previewFrame = document.getElementById("preview-frame");
const placeholder = document.getElementById("placeholder");
const statusMsg = document.getElementById("status-msg");

let pdfFiles = [];

pdfInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (file && file.type === "application/pdf") {
    pdfFiles.push(file);
    renderFiles();
  }
  pdfInput.value = "";
});

function renderFiles(){
  fileList.innerHTML="";
  pdfFiles.forEach((f,i)=>{
    const div=document.createElement("div");
    div.className="file-item";
    div.innerHTML=`
      <span class="file-name">${i+1}. ${f.name}</span>
      <div class="action-btns">
        <button class="btn-view" onclick="viewFile(${i})">View</button>
        <button class="btn-del" onclick="removeFile(${i})">DEL</button>
      </div>`;
    fileList.appendChild(div);
  });
  mergeBtn.disabled = pdfFiles.length < 2;
  statusMsg.innerText = pdfFiles.length < 2
    ? "Add at least 2 files"
    : pdfFiles.length + " files ready";
}

window.removeFile = i => {
  pdfFiles.splice(i,1);
  renderFiles();
  if(!pdfFiles.length){
    previewFrame.style.display="none";
    placeholder.style.display="block";
  }
};

window.viewFile = i => {
  const url = URL.createObjectURL(pdfFiles[i]);
  previewFrame.src=url;
  previewFrame.style.display="block";
  placeholder.style.display="none";
};

mergeBtn.addEventListener("click", async ()=>{
  statusMsg.innerText="Uploading & processing...";
  mergeBtn.disabled=true;

  const formData=new FormData();
  pdfFiles.forEach(f=>formData.append("pdfs",f));

  const res = await fetch("/merge", {
    method:"POST",
    body:formData
  });

  const blob = await res.blob();
  const name = prompt("Enter file name","merged_file") || "merged_file";
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name.endsWith(".pdf")?name:name+".pdf";
  a.click();

  statusMsg.innerText="Done âœ…";
  mergeBtn.disabled=false;
});
</script>

</body>
</html>


